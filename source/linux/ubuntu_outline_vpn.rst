Установка Outline VPN на Ubuntu 20.04
=====================================

Outline VPN - это бесплатный инструмент с открытым исходным кодом,
позволяющий развернуть собственную VPN на Вашем собственном сервере или
на машине облачного провайдера. Подробную информацию Вы можете узнать
`здесь <https://getoutline.org/ru/>`_ и `здесь <https://en.wikipedia.org/wiki/Outline_VPN>`_.

В своем составе имеет как графические инструменты, так и средства работы
через командную строку. Позволяет использовать VPN как на настольных
компьютерах, так и на мобильных устройствах.

Прежде чем начать
-----------------

Вам нужен сервер. Да, его нужно арендовать, учитывая его местоположение.
Например, если Вам нужно получать доступ к ресурсам, которые недоступны
в текущем местоположении, но доступны, например, в Канаде, то смело
арендуйте виртуальную машину в AWS, Digital Ocean или любом другом
месте.

Для простых задач, например открытие сайтов, обмена текстовыми
сообщениями в мессенджерах и т.д., подойдет хост с минимальными
ресурсами:

-  1 ядро CPU.
-  1 ГБ RAM (можно и меньше).
-  10 GB HDD для файлов ОС в основном.

Стоимость аренды такого сервера от $3 до $5 в месяц, плюс-минус. По
необходимости ресурсов можно добавлять поболее. Операционная система -
Ubuntu 20.04, т.к. инструкция именно для нее :)

Как арендовать виртуальную машину тут рассматривать не будем, все
зависит от провайдера.

Начальная настройка сервера
---------------------------

И так, виртуальная машина арендована, доступ к ней по SSH имеется,
Ubuntu установлена. Далее устанавливаем последние обновления.

.. code:: bash

   sudo apt update
   sudo apt upgrade

Сделайте перезагрузку машины после этого, если есть необходимость после
установки обновлений.

Сразу настроим брэндмауэр, чтобы защитить машину от несанкционированного
доступа.

.. code:: bash

   sudo ufw allow 443/tcp
   sudo ufw allow 8080/tcp

Открываем доступ через SSH.

.. code:: bash

   sudo ufw allow 22/tcp

Если у Вас статический IP, то для безопасности доступ по SSH можно
разрешить только для него.

.. code:: bash

   sudo ufw allow from <ВашПостоянныйIP> to any port 22

И включаем брэндмауэр.

.. code:: bash

   sudo ufw enable

Отлично! Машина защищена. Идем дальше.

Установка Outline Server
------------------------

Для установки воспользуемся готовыми скриптами из проекта
`outline-server <https://github.com/Jigsaw-Code/outline-server>`__
компании Jigsaw.

Скрипт находится по адресу:

.. code:: none

   https://github.com/Jigsaw-Code/outline-server/blob/master/src/server_manager/install_scripts/install_server.sh

Для установки достаточно выполнить следующую команду.

.. code:: bash

   sudo wget -qO- https://raw.githubusercontent.com/Jigsaw-Code/outline-server/master/src/server_manager/install_scripts/install_server.sh | bash

Будет установлен Docker и службы самого Outline, а также все
зависимости. При необходимости Вы можете установить Docker
самостоятельно перед запуском скрипта.

.. code:: bash

   sudo curl https://get.docker.com | sh

Когда скрипт закончит, то выведет примерно такое содержимое.

.. code:: bash

   { 
     "apiUrl": "https://0.0.0.0:0000/XXXXXXXXXXXX", 
     "certSha256": "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX" 
   }

Сохраните это себе на будущее. По факту сервер Outline VPN уже
установлен и нам лишь нужно его настроить для своих нужд.

Клиент для управления сервером
------------------------------

Управление серверном VPN, в т.ч. раздача доступов, осуществляется с
помощью `Outline Manager <https://getoutline.org/ru/get-started/#step-1>`_, 
доступной для Windows, Max и Linux.

При запуске нужно добавить сервер и выбрать “Настроить Outline где
угодно”. Появится инструкция по установке с помощью скрипта, который мы
ранее запускали. А после поле для ввода ключа и адреса, который Вы до
этого сохранили.

После этого у Вас появится доступ к управлению сервером.

Добавляем ключ
--------------

В Outline Manager добавляем новый ключ в управлении сервером. Программа
покажет `ссылку на
инструкцию <https://github.com/Jigsaw-Code/outline-client/blob/master/docs/invitation-instructions.md>`__
и сам ключ в виде строки:

.. code:: bash

   ss://XXXXXXXXXXXX@9.9.9.9:0/?outline=1

Скопируйте этот ключ, он понадобиться при запуске клиента Outline.

Клиент для подключения
----------------------

И последний шаг - установка `клиента для
подключения <https://getoutline.org/ru/get-started/#step-3>`_. 
Есть приложения для Android, Windows, Chrome, iOS, MacOS, Linux.

При первом запуске нужно нажать “Добавить сервер” и вставить полученный
выше ключ.

Готово!

Послесловие
-----------

Теперь Вы можете использовать Outline VPN. Надеюсь, что Вы будете его
использовать без злого умысла.

Полезные ссылки
---------------

-  `Официальный сайт <https://getoutline.org/ru/how-it-works/>`_
-  `Официальный репозиторий на GitHub <https://github.com/outline/outline>`_
-  `Официальная документация <https://app.getoutline.com/share/770a97da-13e5-401e-9f8a-37949c19f97e/doc/hosting-outline-nipGaCRBDu>`_
-  `Outline: Делаем свой личный VPN от Google за 5$ в месяц (и за 1€ для продвинутых) <https://habr.com/ru/post/358828/>`_
-  `How to setup an Outline VPN Server on Ubuntu 16.04 <https://gist.github.com/okeehou/275bb83601be346921622e05f13cba70>`_
